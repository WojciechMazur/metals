<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/metals/blog/rss.xml" title="Metals RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/metals/blog/atom.xml" title="Metals Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-140140828-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-140140828-1",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Metals" href="/metals/opensearch.xml"><title data-react-helmet="true">Contributing to Metals | Metals</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="http://scalameta.org/metals/img/scalameta-logo.png"><meta data-react-helmet="true" name="twitter:image" content="http://scalameta.org/metals/img/scalameta-logo.png"><meta data-react-helmet="true" property="og:url" content="http://scalameta.org/metals/docs/contributors/getting-started"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Contributing to Metals | Metals"><meta data-react-helmet="true" name="description" content="Whenever you are stuck or unsure, please open an issue or [ask us on"><meta data-react-helmet="true" property="og:description" content="Whenever you are stuck or unsure, please open an issue or [ask us on"><link data-react-helmet="true" rel="icon" href="/metals/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://scalameta.org/metals/docs/contributors/getting-started"><link data-react-helmet="true" rel="alternate" href="http://scalameta.org/metals/docs/contributors/getting-started" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://scalameta.org/metals/docs/contributors/getting-started" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/metals/assets/css/styles.ab6f3053.css">
<link rel="preload" href="/metals/assets/js/runtime~main.b7a0d88b.js" as="script">
<link rel="preload" href="/metals/assets/js/main.0a0b79e0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/metals/"><div class="navbar__logo"><img src="/metals/img/scalameta-logo.png" alt="Metals" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/metals/img/scalameta-logo.png" alt="Metals" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Metals</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/metals/docs/">Docs</a><a class="navbar__item navbar__link" href="/metals/blog/">Blog</a><a href="https://github.com/scalameta/metals" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">üåô</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">‚òÄÔ∏è</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/metals/docs/">Text Editors</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/metals/docs/features/codeactions">Features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/metals/docs/build-tools/overview">Build Tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/metals/docs/contributors/project-goals">Contributing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metals/docs/contributors/project-goals">Project Goals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/metals/docs/contributors/getting-started">Contributing to Metals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metals/docs/contributors/updating-website">Contributing to the website</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metals/docs/contributors/releasing">Making a release</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/metals/docs/integrations/remote-language-server">Integrating with Metals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/metals/docs/troubleshooting/proxy">Troubleshooting</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Contributing to Metals</h1></header><p>Whenever you are stuck or unsure, please open an issue or <a href="https://discord.gg/DwTc8xbNDd" target="_blank" rel="noopener noreferrer">ask us on
Discord</a> or <a href="https://matrix.to/#/#scalameta:metals-contributors" target="_blank" rel="noopener noreferrer">on our Matrix
bridge</a>. This project
follows <a href="https://github.com/scalameta/scalameta/blob/master/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer">Scalameta&#x27;s contribution
guidelines</a>
and the <a href="https://scala-lang.org/conduct/" target="_blank" rel="noopener noreferrer">Scala CoC</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="requirements">Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">‚Äã</a></h2><p>You will need the following applications installed:</p><ul><li>Java 17, 11 or 8 - Make sure <code>JAVA_HOME</code> points to a Java 17, 11 or 8 installation.
Metals will need to build and run on <em>all of them</em>, with support for 8
probably being dropped in the near future.</li><li><code>git</code></li><li><code>sbt</code> (for building a local version of the server)</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="project-structure">Project structure<a class="hash-link" href="#project-structure" title="Direct link to heading">‚Äã</a></h2><ul><li><code>metals</code> the main project with sources of the Metals language server.</li><li><code>mtags</code> Scala version specific module used to interact with the Scala
presentation compiler. It&#x27;s a dependency of the <code>metals</code> project and can
additionally be used by via <code>mtags-interfaces</code> to support multiple Scala
versions inside the Metals server. It&#x27;s also used by other projects like
<a href="https://github.com/scalameta/metabrowse" target="_blank" rel="noopener noreferrer">Metabrowse</a>.</li><li><code>mtags-interfaces</code> - java interfaces for the presentation compiler.</li><li><code>tests/unit</code> moderately fast-running unit tests.</li><li><code>tests/cross</code> - tests targeting cross builds for common features such as
hover, completions, signatures etc.</li><li><code>tests/input</code> example Scala code that is used as testing data for unit tests.</li><li><code>tests/slow</code> slow integration tests.</li><li><code>sbt-metals</code> the sbt plugin used when users are using the BSP support from
sbt to ensure semanticDB is being produced by sbt.</li><li><code>docs</code> documentation markdown for the Metals website.</li><li><code>metals-docs</code> methods used for generating documentation across multiple pages
in <code>docs</code>.</li><li><code>website</code> holds the static site configuration, style and blogs posts for the
Metals website.</li></ul><p>Below diagram shows project structure and dependencies among modules. Note that
<code>default-&lt;suffix&gt;</code> is a <a href="https://www.scala-sbt.org/1.x/docs/Multi-Project.html#Default+root+project" target="_blank" rel="noopener noreferrer">default root project</a>
created implicitly by sbt.
<img src="https://imgur.com/oIhXd5l.png" alt="Projects diagram"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="related-projects">Related projects<a class="hash-link" href="#related-projects" title="Direct link to heading">‚Äã</a></h2><p>The improvement you are looking to contribute may belong in a separate
repository:</p><ul><li><a href="https://github.com/scalameta/metals-vscode/" target="_blank" rel="noopener noreferrer">scalameta/metals-vscode</a>: the
Visual Studio Code extension for Metals.</li><li><a href="https://github.com/scalameta/nvim-metals/" target="_blank" rel="noopener noreferrer">scalameta/nvim-metals</a>: the Neovim
extension for Metals using the built-in LSP support of Neovim.</li><li><a href="https://github.com/scalameta/scalameta/" target="_blank" rel="noopener noreferrer">scalameta/scalameta</a>: SemanticDB,
parsing, tokenization.</li><li><a href="https://github.com/scalameta/munit/" target="_blank" rel="noopener noreferrer">scalameta/munit</a>: Test framework used in
the main Metals repository</li><li><a href="https://github.com/scalacenter/bloop/" target="_blank" rel="noopener noreferrer">scalacenter/bloop</a>: build server for
compilation.</li><li><a href="https://github.com/scala/scala/" target="_blank" rel="noopener noreferrer">scala/scala</a>: Scala 2 presentation compiler.</li><li><a href="https://github.com/lampepfl/dotty" target="_blank" rel="noopener noreferrer">lampepfl/dotty</a>: Scala 3 presentation
compiler.</li><li><a href="https://github.com/scalameta/scalafmt/" target="_blank" rel="noopener noreferrer">scalameta/scalafmt</a>: code formatting.</li><li><a href="https://github.com/scalacenter/scalafix/" target="_blank" rel="noopener noreferrer">scalacenter/scalafix</a>: code
refactoring and linting.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="common-development-workflow">Common development workflow<a class="hash-link" href="#common-development-workflow" title="Direct link to heading">‚Äã</a></h2><p>Most of the time development in Metals looks like:</p><ul><li>do some changes</li><li>write tests which check if your changes work</li><li>publish Metals server locally and test changes manually</li></ul><p>When diving into part of the code without any prior knowledge it might be hard to comprehend what&#x27;s going on
and what part of the code is responsible for specific behavior. There are several ways to debug Metals,
but most popular are:</p><ul><li>debugging through logging (recommended option)</li><li>classic debugging with breakpoints</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="debugging-through-logging">Debugging through logging<a class="hash-link" href="#debugging-through-logging" title="Direct link to heading">‚Äã</a></h3><p>This approach provides very quick iterations and short feedback loop.
It depends on placing multiple <code>pprint.log()</code> calls which will log
messages in <code>.metals.log</code> file. Logged output can be watched by <code>tail -f .metals/metals.log</code>.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">MetalsLanguageServer.scala:1841 params: DebugSessionParams [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  targets = SingletonList (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    BuildTargetIdentifier [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      uri = &quot;file:/HappyMetalsUser/metals/#metals/Compile&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dataKind = &quot;scala-attach-remote&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  data = {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>See <a href="#workspace-logs">workspace logs</a> for more information.</p><p>This approach can be used in 2 variants:</p><ul><li>together with <a href="#manual-tests">manual testing</a> when it&#x27;s hard to write test
for some changes.</li><li>with <a href="#unit-tests">unit tests</a></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="classic-debugging">Classic debugging<a class="hash-link" href="#classic-debugging" title="Direct link to heading">‚Äã</a></h3><p>Classic debugging is possible by the <a href="#jvm-debugging">JVM debugging mechanism</a>.
Publish Metals locally, open a new project and configure debug settings.
Then you can attach IDE with opened Metals repository to the debugged instance:</p><ul><li><p>VSCode - add attach configuration to yours <a href="/metals/docs/editors/vscode#via-a-launchjson-configuration">launch.json</a></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;version&quot;: &quot;0.2.0&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;configurations&quot;: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Attach debugger when running via:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // `-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=localhost:5005`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;type&quot;: &quot;scala&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;request&quot;: &quot;attach&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;name&quot;: &quot;Attach debugger to Metals server&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;buildTarget&quot;: &quot;metals&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;hostName&quot;: &quot;localhost&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;port&quot;: 5005</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then pick such a defined configuration and run debug.</p><p><img src="https://imgur.com/ySAo6Um.png" alt="Attach debugger"></p></li><li><p>IntelliJ - Select Attach to the process and pick proper process from the list</p><p><img src="https://imgur.com/lHSl57l.png" alt="Attach to the process"></p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="unit-tests">Unit tests<a class="hash-link" href="#unit-tests" title="Direct link to heading">‚Äã</a></h2><p>To run the unit tests open an sbt shell and run <code>unit/test</code>. However, this command will
run all of the unit tests declared in <code>unit</code> module.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sbt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># (recommended) run a specific test suite, great for edit/test/debug workflows.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; unit/testOnly tests.DefinitionSuite</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run a specific test case inside the suite.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; unit/testOnly tests.DefinitionSuite -- &lt;exact-test-name&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run unit tests, moderately fast but still a bit too slow for edit/test/debug workflows.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; unit/test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run slow integration tests, takes several minutes.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; slow/test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># (not recommended) run all tests, slow. It&#x27;s better to target individual projects.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="manually-testing-a-lspsuite">Manually testing a <code>LspSuite</code><a class="hash-link" href="#manually-testing-a-lspsuite" title="Direct link to heading">‚Äã</a></h3><p>Every test suite that extends <code>LspSuite</code> generates a workspace directory under
<code>tests/unit/target/e2e/&lt;suitename&gt;/&lt;testname&gt;</code>. To debug why a <code>LspSuite</code> might be
failing, run the test once and then open it directly in the editor. For
example, for the test case <code>&quot;deprecated-scala&quot;</code> in <code>WarningsLspSuite</code> run the
following command:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">code tests/unit/target/e2e/warnings/deprecated-scala</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will open Visual Studio Code in directory with test project and it&#x27;ll be
possible to investigate why test is failing manually.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="cross-tests">Cross tests<a class="hash-link" href="#cross-tests" title="Direct link to heading">‚Äã</a></h2><p>These tests check common features such as hover, completions or signatures for
different scala version.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sbt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run presentation compiler tests, these are the quickest tests to run.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; cross/test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> run presentation compiler tests for all Scala versions.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; +cross/test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="manual-tests">Manual tests<a class="hash-link" href="#manual-tests" title="Direct link to heading">‚Äã</a></h2><p>Some functionality is best to manually test through an editor. A common workflow
while iterating on a new feature is to run <code>publishLocal</code> and then open an
editor in a small demo build.</p><p>It&#x27;s important to note that <code>sbt publishLocal</code> will create artifacts only for
the Scala version currently used in Metals and trying to use the snapshot
version with any other Scala version will not work. In that case you need to run
a full cross publish with <code>sbt +publishLocal</code>, however this will take quite some
time, so you may want to target a specific version to publish like <code>++3.1.1 mtags/publishLocal</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="visual-studio-code">Visual Studio Code<a class="hash-link" href="#visual-studio-code" title="Direct link to heading">‚Äã</a></h3><p>Install the Metals extension from the Marketplace by searching for &quot;Metals&quot;.</p><p><a href="vscode:extension/scalameta.metals" target="_blank" rel="noopener noreferrer">Click here to install the Metals VS Code plugin</a></p><p>Next, update the &quot;Server version&quot; setting under preferences to point to the
version you published locally via <code>sbt publishLocal</code>.</p><p><img src="https://i.imgur.com/ogVWI1t.png" alt="Metals server version setting"></p><p>When you make changes in the Metals Scala codebase</p><ul><li>run <code>sbt publishLocal</code></li><li>execute the &quot;Metals: Restart server&quot; command in Visual Studio Code (via
command palette)</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="vimneovim">Vim/Neovim<a class="hash-link" href="#vimneovim" title="Direct link to heading">‚Äã</a></h3><p>If using <code>nvim-metals</code>:</p><p>You&#x27;ll want to make sure to read the docs
<a href="https://github.com/scalameta/nvim-metals/blob/main/doc/metals.txt" target="_blank" rel="noopener noreferrer">here</a> and
take a look at the example configuration
<a href="https://github.com/scalameta/nvim-metals/discussions/39" target="_blank" rel="noopener noreferrer">here</a> if you haven&#x27;t
already set everything up.</p><ul><li>run <code>sbt publishLocal</code></li><li>set the <code>serverVersion</code> in your <code>settings</code> table that you pass in to your
metals config.</li><li>Open your workspace and trigger a <code>:MetalsUpdate</code> followed by a
<code>:MetalsRestart</code>. NOTE: that every time you publish locally you&#x27;ll want to
trigger this again.</li></ul><p>If you are using another Vim client, write a <code>new-metals-vim</code> script that builds
a new <code>metals-vim</code> bootstrap script using the locally published version.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">coursier bootstrap \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --java-opt -Dmetals.client=&lt;&lt;NAME_OF_CLIENT&gt;&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  org.scalameta:metals_2.13:0.11.10-SNAPSHOT \ # double-check version here</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -r bintray:scalacenter/releases \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -o /usr/local/bin/metals-vim -f</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>NOTE</strong> if you&#x27;re able to configure your client using initialization options,
then the <code>client</code> property is not necessary. You can see all the options
<a href="https://scalameta.org/metals/docs/integrations/new-editor#initializationoptions" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Finally, start Vim with the local Metals version</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd test-workspace # any directory you want to manually test Metals</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">new-metals-vim &amp;&amp; vim build.sbt # remember to have the script in your $PATH</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When you make changes in the Metals Scala codebase, run <code>sbt publishLocal</code>, quit
vim and re-run <code>new-metals-vim &amp;&amp; vim build.sbt</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="workspace-logs">Workspace logs<a class="hash-link" href="#workspace-logs" title="Direct link to heading">‚Äã</a></h2><p>Metals logs workspace-specific information to the
<code>$WORKSPACE/.metals/metals.log</code> file.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">tail -f .metals/metals.log</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>These logs contain information that may be relevant for regular users.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="json-rpc-trace">JSON-RPC trace<a class="hash-link" href="#json-rpc-trace" title="Direct link to heading">‚Äã</a></h2><p>To see the trace of incoming/outgoing JSON communication with the text editor
or build server, create empty files in <code>$WORKSPACE/.metals/</code> or your machine cache
directory.</p><p>However, we do not recommend using your machine cache directory because
trace files located there are shared between all Metals instances, hence multiple
servers can override the same file. Using <code>$WORKSPACE/.metals/</code> solves this issue and
also allows user to have more precise control over which metals instances log
their JSON-RPC communication.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Linux and macOS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">touch $WORKSPACE/.metals/lsp.trace.json # text editor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">touch $WORKSPACE/.metals/bsp.trace.json # build server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">touch $WORKSPACE/.metals/dap-server.trace.json # debug adapter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">touch $WORKSPACE/.metals/dap-client.trace.json # debug adapter</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Windows</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type nul &gt; $WORKSPACE/.metals/lsp.trace.json # text editor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type nul &gt; $WORKSPACE/.metals/bsp.trace.json # build server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type nul &gt; $WORKSPACE/.metals/dap-server.trace.json # debug adapter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type nul &gt; $WORKSPACE/.metals/dap-client.trace.json # debug adapter</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Next when you start Metals, watch the logs with <code>tail -f</code>.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Linux and macOS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tail -f $WORKSPACE/.metals/lsp.trace.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The traces are very verbose so it&#x27;s recommended to delete the files if you are
not interested in debugging the JSON communication.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="jvm-debugging">JVM Debugging<a class="hash-link" href="#jvm-debugging" title="Direct link to heading">‚Äã</a></h2><p>To debug the JVM with the Metals server, add a property to your
<code>Server Properties</code> with the usual Java debugging flags, making sure you have
the <code>quiet</code> option on. It&#x27;s important to remember about the flag, as the server
uses standard input/output to communicate with the client, and the default
output of the debugger interferes with that.</p><p>This property will make your server run in debug mode on port 5005 without
waiting for the debugger to connect:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005,quiet=y</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="updating-build-tool-launcherwrappers">Updating build tool launcher/wrappers<a class="hash-link" href="#updating-build-tool-launcherwrappers" title="Direct link to heading">‚Äã</a></h2><p>Metals uses various wrappers or launchers for each build tool that it supports.
This makes sure that when your in a workspace for you build tool that metals is
able to correctly launch that build tool, even if it doesn&#x27;t exist on the users
<code>$PATH</code>. You can see their usages in <code>&lt;BuildToolName&gt;BuildTool.scala</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="updating-sbt-launcher">Updating sbt-launcher<a class="hash-link" href="#updating-sbt-launcher" title="Direct link to heading">‚Äã</a></h3><p>The easiest way to update the sbt-launcher is with the following coursier
command:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp &quot;$(cs fetch org.scala-sbt:sbt-launch:&lt;version&gt;)&quot; sbt-launch.jar</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will allow you to not have to do some of the manual steps with the launcher
properties file listed <a href="https://github.com/sbt/launcher" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="updating-maven-wrappers">Updating maven wrappers<a class="hash-link" href="#updating-maven-wrappers" title="Direct link to heading">‚Äã</a></h3><p>For Maven we use the <a href="https://maven.apache.org/wrapper/maven-wrapper/index.html" target="_blank" rel="noopener noreferrer">Maven
Wrapper</a>. In order to
update this you&#x27;ll want to do the following:</p><ul><li>Run the <code>./bin/update-maven-wrapper.sh</code> script</li><li>Update the <code>def version</code> in <code>MavenBuildTool.scala</code> to the latest version
that you just updated to.</li><li>Run the specific maven tests and ensure they pass: <code>./bin/test.sh
  &#x27;slow/testOnly -- tests.maven.*</code></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="git-hooks">Git hooks<a class="hash-link" href="#git-hooks" title="Direct link to heading">‚Äã</a></h2><p>This git repository has a pre-push hook to run Scalafmt.</p><p>The CI also uses Scalafix to assert that there a no unused imports. To
automatically remove unused imports run <code>sbt scalafixAll</code>. We don&#x27;t run Scalafix
as a pre-push git hook since starting sbt takes a long time.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/scalameta/metals/edit/main/docs/contributors/getting-started.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/metals/docs/contributors/project-goals"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Project Goals</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/metals/docs/contributors/updating-website"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contributing to the website</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#project-structure" class="table-of-contents__link toc-highlight">Project structure</a></li><li><a href="#related-projects" class="table-of-contents__link toc-highlight">Related projects</a></li><li><a href="#common-development-workflow" class="table-of-contents__link toc-highlight">Common development workflow</a><ul><li><a href="#debugging-through-logging" class="table-of-contents__link toc-highlight">Debugging through logging</a></li><li><a href="#classic-debugging" class="table-of-contents__link toc-highlight">Classic debugging</a></li></ul></li><li><a href="#unit-tests" class="table-of-contents__link toc-highlight">Unit tests</a><ul><li><a href="#manually-testing-a-lspsuite" class="table-of-contents__link toc-highlight">Manually testing a <code>LspSuite</code></a></li></ul></li><li><a href="#cross-tests" class="table-of-contents__link toc-highlight">Cross tests</a></li><li><a href="#manual-tests" class="table-of-contents__link toc-highlight">Manual tests</a><ul><li><a href="#visual-studio-code" class="table-of-contents__link toc-highlight">Visual Studio Code</a></li><li><a href="#vimneovim" class="table-of-contents__link toc-highlight">Vim/Neovim</a></li></ul></li><li><a href="#workspace-logs" class="table-of-contents__link toc-highlight">Workspace logs</a></li><li><a href="#json-rpc-trace" class="table-of-contents__link toc-highlight">JSON-RPC trace</a></li><li><a href="#jvm-debugging" class="table-of-contents__link toc-highlight">JVM Debugging</a></li><li><a href="#updating-build-tool-launcherwrappers" class="table-of-contents__link toc-highlight">Updating build tool launcher/wrappers</a><ul><li><a href="#updating-sbt-launcher" class="table-of-contents__link toc-highlight">Updating sbt-launcher</a></li><li><a href="#updating-maven-wrappers" class="table-of-contents__link toc-highlight">Updating maven wrappers</a></li></ul></li><li><a href="#git-hooks" class="table-of-contents__link toc-highlight">Git hooks</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Overview</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/metals/docs/overview/editor-support">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/metals/docs/build-tools/overview">Build Tools</a></li><li class="footer__item"><a class="footer__link-item" href="/metals/docs/contributors/project-goals">Project Goals</a></li><li class="footer__item"><a class="footer__link-item" href="/metals/docs/contributors/getting-started">Contributing</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/scalameta/metals" target="_blank">
                      <img src="https://img.shields.io/github/stars/scalameta/metals.svg?color=%23087e8b&label=stars&logo=github&style=social">
                    </a></li><li class="footer__item"><a href="https://discord.gg/RFpSVth" target="_blank">
                      <img src="https://img.shields.io/discord/632642981228314653?logo=discord&style=social">
                    </a></li><li class="footer__item"><a href="https://twitter.com/scalameta" target="_blank">
                      <img src="https://img.shields.io/twitter/follow/scalameta.svg?logo=twitter&style=social">
                    </a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/metals/img/scalameta-logo.png" alt="" class="themedImage_W2Cr themedImage--light_TfLj footer__logo"><img src="/metals/img/scalameta-logo.png" alt="" class="themedImage_W2Cr themedImage--dark_oUvU footer__logo"></div><div class="footer__copyright">Copyright ¬© 2022 Metals</div></div></div></footer></div>
<script src="/metals/assets/js/runtime~main.b7a0d88b.js"></script>
<script src="/metals/assets/js/main.0a0b79e0.js"></script>
</body>
</html>